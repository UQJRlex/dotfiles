#!/usr/bin/sh
# @author nate zhou
# @since 2024,2025
# use wmenu to select the screen and audio source for screen casting

source $HOME/.local/bin/wmenu-color 2>/dev/null

SWAYSOCK=/run/user/$(id -u)/sway-ipc.$(id -u).$(pgrep -x sway).sock

selected_output="$(swaymsg -t get_outputs -p | grep Output | wmenu-color "-p[$(basename $0)] " "-l 3" | awk '{print $2}')"
selected_source="$(pw-dump | grep "\"node.name\":" | sort | wmenu-color "-p[choose source] " -l 6 | cut -d'"' -f4)"

TMP_DIR="/tmp/i3status"

[ -d "$TMP_DIR" ] || mkdir "$TMP_DIR"
[ -d "$HOME/tmp" ] || mkdir "$HOME/tmp"

# Start the recorder
notify-send -u low -r 1257 "$(basename "$0")" "output $selected_output\nSource $selected_source"
wf-recorder -r 30 -o "$selected_output" --audio="$selected_source" -f "$HOME/tmp/wcast-$(date +%Y-%m-%d-%H-%M-%S).mp4"
