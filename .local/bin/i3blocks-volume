#!/usr/bin/sh
# @author nate zhou
# @since 2025

status="$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
volume="$(echo $status | sed 's/[^0-9]*//g; s/^0//' )"
muted="$(echo $status | grep 'MUTED')"
#exec_always "$HOME"/.local/bin/wobd
wobfifo="/tmp/wob.fifo"

[ -z "$muted" ] && icon="" color="#eeeeee"|| icon="" color="#777777"

case $BLOCK_BUTTON in
    1) notify-send -u low -r 3301 "$icon $(basename $0)" "$(wpctl get-volume @DEFAULT_AUDIO_SINK@ | sed 's/[^0-9]//g; s/^0//')% $(pactl get-default-sink)"
        ;;
    3) wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle && pkill -SIGRTMIN+1 i3blocks &
        ;;
    5) wpctl set-volume @DEFAULT_AUDIO_SINK@ 1%- && wpctl get-volume @DEFAULT_AUDIO_SINK@ | sed 's/[^0-9]//g; s/^0//' > $wobfifo && pkill -SIGRTMIN+1 i3blocks &
        ;;
    2) wsink >/dev/null &
        ;;
    4) wpctl set-volume @DEFAULT_AUDIO_SINK@ 1%+ && wpctl get-volume @DEFAULT_AUDIO_SINK@ | sed 's/[^0-9]//g; s/^0//' > $wobfifo && pkill -SIGRTMIN+1 i3blocks &
        ;;
    #8) wsink>/dev/null &
    #    ;;
esac

# ` `(U+2009) is the Thin Space
echo "$icon" "$volume"%
echo

echo "$color"
